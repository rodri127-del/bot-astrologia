name: Publicar Contenido Diario - 4 Veces

on:
  schedule:
    - cron: '0 9 * * *'  # 9:00 AM
    - cron: '0 12 * * *'  # 12:00 PM  
    - cron: '0 15 * * *'  # 3:00 PM
    - cron: '0 18 * * *'  # 6:00 PM
  workflow_dispatch:
    inputs:
      publicacion_numero:
        description: 'Número de publicación (0-3)'
        required: true
        default: '0'
        type: choice
        options:
          - '0'
          - '1'
          - '2'
          - '3'

jobs:
  publicar:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install twitter-api-v2 node-fetch

      - name: Determinar número de publicación
        id: pub_num
        run: |
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            echo "PUB_NUM=${{ github.event.inputs.publicacion_numero }}" >> $GITHUB_ENV
          else
            # Para schedule, determinar por hora UTC
            HORA_UTC=$(date -u +%H)
            echo "Hora UTC: $HORA_UTC"
            if [ "$HORA_UTC" = "09" ]; then
              echo "PUB_NUM=0" >> $GITHUB_ENV
            elif [ "$HORA_UTC" = "12" ]; then
              echo "PUB_NUM=1" >> $GITHUB_ENV
            elif [ "$HORA_UTC" = "15" ]; then
              echo "PUB_NUM=2" >> $GITHUB_ENV
            elif [ "$HORA_UTC" = "18" ]; then
              echo "PUB_NUM=3" >> $GITHUB_ENV
            else
              echo "PUB_NUM=0" >> $GITHUB_ENV
            fi
          fi
          echo "Número de publicación: $PUB_NUM"

      - name: Ejecutar publicación específica
        run: node bot.js $PUB_NUM
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          TWITTER_APP_KEY: ${{ secrets.TWITTER_APP_KEY }}
          TWITTER_APP_SECRET: ${{ secrets.TWITTER_APP_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
